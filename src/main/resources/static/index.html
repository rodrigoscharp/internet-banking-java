<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Internet Banking</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        body { padding-top: 50px; }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-center">Internet Banking</h1>

        <div class="card mt-5">
            <div class="card-header">
                <h2>Contas</h2>
            </div>
            <div class="card-body">
                <table class="table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Proprietário</th>
                            <th>Saldo</th>
                        </tr>
                    </thead>
                    <tbody id="accounts-list">
                    </tbody>
                </table>
            </div>
        </div>

        <div class="row mt-5">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h2>Criar Conta</h2>
                    </div>
                    <div class="card-body">
                        <form id="create-account-form">
                            <div class="form-group">
                                <input type="text" id="owner" class="form-control" placeholder="Proprietário" required>
                            </div>
                            <div class="form-group">
                                <input type="number" id="balance" class="form-control" placeholder="Saldo Inicial" required>
                            </div>
                            <button type="submit" class="btn btn-primary">Criar</button>
                        </form>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h2>Realizar Transferência</h2>
                    </div>
                    <div class="card-body">
                        <form id="transfer-form">
                            <div class="form-group">
                                <input type="number" id="from-account" class="form-control" placeholder="Da Conta (ID)" required>
                            </div>
                            <div class="form-group">
                                <input type="number" id="to-account" class="form-control" placeholder="Para Conta (ID)" required>
                            </div>
                            <div class="form-group">
                                <input type="number" id="amount" class="form-control" placeholder="Valor" required>
                            </div>
                            <button type="submit" class="btn btn-success">Transferir</button>
                        </form>
                        <div id="transfer-result" class="mt-3"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const accountsList = document.getElementById('accounts-list');
        const createAccountForm = document.getElementById('create-account-form');
        const transferForm = document.getElementById('transfer-form');
        const transferResult = document.getElementById('transfer-result');

        async function listAccounts() {
            const response = await fetch('/accounts');
            const accounts = await response.json();
            accountsList.innerHTML = '';
            for (const account of accounts) {
                const tr = document.createElement('tr');
                tr.innerHTML = `<td>${account.id}</td><td>${account.owner}</td><td>R$ ${account.balance.toFixed(2)}</td>`;
                accountsList.appendChild(tr);
            }
        }

        createAccountForm.addEventListener('submit', async (event) => {
            event.preventDefault();
            const owner = document.getElementById('owner').value;
            const balance = document.getElementById('balance').value;
            await fetch('/accounts', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ owner, balance: parseFloat(balance) })
            });
            createAccountForm.reset();
            await listAccounts();
        });

        transferForm.addEventListener('submit', async (event) => {
            event.preventDefault();
            const fromId = document.getElementById('from-account').value;
            const toId = document.getElementById('to-account').value;
            const amount = document.getElementById('amount').value;
            
            transferResult.innerHTML = '';

            try {
                const response = await fetch(`/accounts/transfer?from=${fromId}&to=${toId}&amount=${amount}`, {
                    method: 'POST'
                });

                if (response.ok) {
                    transferResult.innerHTML = '<div class="alert alert-success">Transferência realizada com sucesso!</div>';
                } else {
                    const error = await response.text();
                    transferResult.innerHTML = `<div class="alert alert-danger">${error}</div>`;
                }
            } catch (error) {
                transferResult.innerHTML = `<div class="alert alert-danger">Erro ao realizar a transferência.</div>`;
            }

            transferForm.reset();
            await listAccounts();
        });

        listAccounts();
    </script>
</body>
</html>